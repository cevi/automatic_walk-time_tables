services:

  awt-cypress:

    build:
      context: ./e2e
      dockerfile: Dockerfile

    depends_on:
      awt-frontend:
        condition: service_healthy

    entrypoint: cypress run --browser chrome

    # share the current folder as volume to avoid copying
    working_dir: /opt/e2e
    volumes:
      - ./e2e:/opt/e2e

    env_file:
      - .env.ci-testing

  awt-docs:

    build:
      context: docs/.
      dockerfile: Dockerfile

    env_file:
      - .env.ci-testing

    logging:
      driver: none

  awt-tile-cache:
    env_file:
      - .env.ci-testing

    logging:
      driver: none

  awt-mapfish-print-server:

    env_file:
      - .env.ci-testing
    
    logging:
      driver: none

  awt-swiss-tml-api:

    build:
      context: swiss_TLM_api/.
      dockerfile: Dockerfile

    env_file:
      - .env.ci-testing

    logging:
      driver: none

  awt-backend:

    build:
      context: backend/.
      dockerfile: Dockerfile

    env_file:
      - .env.ci-testing

    logging:
      driver: none

  awt-frontend:

    build:
      context: .
      dockerfile: frontend/Dockerfile
      # Used in the first stage of the Dockerfile, thus these env vars must be passed as args
      args:
        - ENVIRONMENT_FILE=.env.ci-testing

    env_file:
      - .env.ci-testing

    logging:
      driver: none
